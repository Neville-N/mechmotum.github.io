<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>  Creating Linux Servers for JupyterHub | Bicycle Laboratorium
</title>
  <link rel="canonical" href="https://mechmotum.github.io/blog/jupyter-winter-2019.html">


  <link rel="stylesheet" href="https://mechmotum.github.io/theme/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://mechmotum.github.io/theme/css/fontawesome.min.css">
  <link rel="stylesheet" href="https://mechmotum.github.io/theme/css/pygments/default.min.css">
  <link rel="stylesheet" href="https://mechmotum.github.io/theme/css/theme.css">
  <link rel="stylesheet" href="https://mechmotum.github.io/theme/css/origtheme.css">

  <link rel="alternate" type="application/atom+xml" title="Full Atom Feed"
        href="https://mechmotum.github.io/feeds/all.atom.xml">
  <link rel="alternate" type="application/atom+xml" title="Categories Atom Feed"
        href="https://mechmotum.github.io/feeds/education.atom.xml">  
  <meta name="description" content="Blog post on setting up JupyterHub for a future computing cluster">


</head>

<body>
  <header class="header">
    <div class="container">
<div class="row">
    <div class="col-sm-4">
      <a href="https://mechmotum.github.io/">
        <img class="site-image img-fluid rounded" src=https://objects-us-east-1.dream.io/mechmotum/bear-bicycle-transparent-480x480.png alt="Bicycle Laboratorium">
      </a>
    </div>
  <div class="col-sm-8">
    <img src=https://objects-us-east-1.dream.io/mechmotum/tu-delft-logo-233x100.png height=100px>
    <h1 class="title"><a href="https://mechmotum.github.io/">Bicycle Laboratorium</a></h1>
      <p class="text-muted">E pur si muove</p>
      <ul class="list-inline">
            <li class="list-inline-item"><a href="https://mechmotum.github.io/">About</a></li>
            <li class="list-inline-item"><a href="https://mechmotum.github.io/members.html">Members</a></li>
            <li class="list-inline-item"><a href="https://mechmotum.github.io/research.html">Research</a></li>
            <li class="list-inline-item"><a href="https://mechmotum.github.io/products.html">Products</a></li>
            <li class="list-inline-item"><a href="https://mechmotum.github.io/jobs.html">Positions</a></li>
            <li class="list-inline-item"><a href="https://mechmotum.github.io/guide.html">Guide</a></li>
            <li class="list-inline-item"><a href="https://mechmotum.github.io/contact.html">Contact</a></li>
          <li class="list-inline-item"><a href="/blog/">Blog</a></li>
      </ul>
  </div>
</div>    </div>
  </header>

  <div class="main">
    <div class="container">
      <h1>  Creating Linux Servers for JupyterHub
</h1>
      <hr>
  <article class="article">
    <header>
      <ul class="list-inline">
        <li class="list-inline-item text-muted" title="2019-05-03T00:00:00-07:00">
          <i class="fas fa-clock"></i>
          Fri 03 May 2019
        </li>
        <li class="list-inline-item">
          <i class="fas fa-folder-open"></i>
          <a href="https://mechmotum.github.io/category/education.html">education</a>
        </li>
          <li class="list-inline-item">
            <i class="fas fa-user"></i>
              <a href="https://mechmotum.github.io/author/celine-liang.html">Celine Liang</a>,               <a href="https://mechmotum.github.io/author/kevin-krausse.html">Kevin Krausse</a>,               <a href="https://mechmotum.github.io/author/xin-luigi-chen.html">Xin Luigi Chen</a>,               <a href="https://mechmotum.github.io/author/xiaochen-zeng.html">Xiaochen Zeng</a>          </li>
          <li class="list-inline-item">
            <i class="fas fa-tag"></i>
              <a href="https://mechmotum.github.io/tag/oer.html">#oer</a>,               <a href="https://mechmotum.github.io/tag/education.html">#education</a>,               <a href="https://mechmotum.github.io/tag/jupyter.html">#jupyter</a>,               <a href="https://mechmotum.github.io/tag/textbooks.html">#textbooks</a>,               <a href="https://mechmotum.github.io/tag/engineering.html">#engineering</a>,               <a href="https://mechmotum.github.io/tag/libretexts.html">#libretexts</a>          </li>
      </ul>
    </header>


    <div class="content">
      <div class="section" id="background">
<h2>Background</h2>
<p>As part of the <a class="reference external" href="libretexts-grant.rst">$5M grant</a> awarded to the LibreTexts
project last year, our team had two goals: to integrate Jupyter into the
LibreTexts website and to create a computing cluster running JupyterHub to
serve LibreTexts and UC Davis users. This quarter, we focused on researching
how to create the cluster through building test servers.</p>
</div>
<div class="section" id="virtual-machine-environment">
<h2>Virtual Machine Environment</h2>
<p>The first step in our journey to building a cluster was to familiarize
ourselves with how to setup a single server. It was crucial for us to really
understand all the details on how to setup a single server, as we would need
the knowledge to setup each and every single node in the cluster. We decided to
use VirtualBox as our starting playground so we had an easily disposable
environments to learn from.</p>
</div>
<div class="section" id="raid1-and-lvm">
<h2>RAID1 and LVM</h2>
<p>We started adding more features to the installations that we would eventually
use in our cluster configuration. We started by adding a software RAID1 to our
installations to familiarize ourselves with the process, and then we moved on
to adding LVM too.</p>
<p>Redundant Array of Independent Disks, also known as RAID, provides multiple
ways of orchestrating and synchronizing multiple hard drives in a computer
network to establish reliable data storage within the network. We decided to
use RAID1, which consists of an exact copy of a set of data on two or more
disks. We chose RAID1 because it allows us to switch a drive while the server
is live, in case a drive fails.</p>
<p>Logical Volume Manager, also known as LVM, is a device mapper target that
provides logical volume management for the Linux kernel. The benefits of using
LVM is the ability to use and manage &quot;dynamic partitions&quot;. When using LVM
&quot;partitions&quot;, known just as logical volumes, we can manage them very easily
through the command line if we wanted to either create additional partitions,
or resize/delete any existing partitions.</p>
<p>While installing Ubuntu Live Server 18.04 with RAID1, we ran into an issue
where the server failed to start. According to the <a class="reference external" href="https://wiki.ubuntu.com/BionicBeaver/ReleaseNotes#Server_installer">Ubuntu 18.04.02 Release
Notes</a>:</p>
<blockquote>
<p>The next generation Subiquity server installer, brings the comfortable live
session and speedy install of Ubuntu Desktop to server users at last.</p>
<p>N.B., If you require multipath, full-disk encryption, or the ability to
re-using existing partitions, you will want to continue to use the alternate
installer which can be downloaded from
<a class="reference external" href="http://cdimage.ubuntu.com/releases/18.04/release/">http://cdimage.ubuntu.com/releases/18.04/release/</a></p>
<p>As of 18.04.1, the Subiquity server installer now supports LVM, RAID, vlans,
and bonds.</p>
</blockquote>
<p>After some researching, we learned however that <a class="reference external" href="https://bugs.launchpad.net/subiquity/+bug/1785332">a bug</a> from the Ubuntu Live
Server image caused the installer to fail to mount the boot partition,
preventing the installation of Ubuntu on RAID1. We instead used this <a class="reference external" href="http://cdimage.ubuntu.com/releases/18.04.2/release/ubuntu-18.04.2-server-amd64.iso">alternate
installer (non-live server image file)</a>
to successfully install Ubuntu Server 18.04 with RAID1 on the virtual machines.</p>
<p>When installing Ubuntu Server with RAID1 and LVM on our virtual machines, we
did not allot enough space on our hard disks for the operating system and
JupyterHub combined. We determined that in total, the operating system and
JupyterHub required about 15 GB of storage. To be safe, we now recommend to
create two 20 GB virtual hard disks for setting up JupyterHub.</p>
<p>Our individual setups varied between each test server. In one successful setup,
each hard disk contained two partitions. One partition contained 2.0 GB and was
mounted on <tt class="docutils literal">/boot</tt> as the boot partition. The other partition contained 19.5
GB, serving as primary storage.</p>
<p>We plan to have a stack of Ubuntu 18, RAID1, and LVM as our standard setup for
each node in the cluster.</p>
</div>
<div class="section" id="jupyterhub-bare-metal">
<h2>JupyterHub Bare-Metal</h2>
<p>Our next step was trying to setup a bare-metal verion of JupyterHub in our
virtual machines.  We followed the instructions provided in the repository,
<a class="reference external" href="https://github.com/mechmotum/jupyterhub-deploy-teaching">jupyterhub-deploy-teaching</a>, to install
JupyterHub on our virtual machines and connect to it through the browser. The
repository is a &quot;light fork&quot; from the JupyterHub's <a class="reference external" href="https://github.com/jupyterhub/jupyterhub-deploy-teaching">original
jupyterhub-deploy-teaching</a> repository,
intended for UC Davis usage.</p>
<p>We ran into a few issues during the installation process.  The Ansible script
in the repository was missing some required installations.  The package
<cite>python3-distutils</cite> is required by JupyterHub but was not installed. The
package was a part of Ubuntu 16.04, so the Ansible script did not need to
specify installing <tt class="docutils literal"><span class="pre">python3-disutils</span></tt> previously. This was fixed in the
Ansible Playbook via <a class="reference external" href="https://github.com/mechmotum/jupyterhub-deploy-teaching/commit/51b070a9ae3223d1919ec56323411ef455d642e5">this commit</a>.</p>
<p>We also encountered Conda errors while installing JupyterHub. We suspect that
this is due to the submodules from the <a class="reference external" href="https://github.com/UDST/ansible-conda/tree/f26ac9f82bb96035d9d96a1531d62456c959229d">ansible-conda</a>
repository, which are fixed by running their updates in our automatic
configuration and deploying script, <tt class="docutils literal">setup.sh</tt>.</p>
<p>After succeeding in setting up JupyterHub on our virtual machines, we
incorporated the changes into the configuration files and completed
<tt class="docutils literal">setup.sh</tt> to automate the installation process, testing it to make sure that
it worked. The script <tt class="docutils literal">setup.sh</tt> automates the following configuration tasks:</p>
<ol class="arabic simple">
<li>Adds submodules from the <a class="reference external" href="https://github.com/UDST/ansible-conda/tree/f26ac9f82bb96035d9d96a1531d62456c959229d">ansible-conda</a>
repository.</li>
<li>Adds the current user to as an admin and user.</li>
<li>Generates a proxy_auth_token and inputs it into the configuration file.</li>
<li>Generates a self-signed SSL certificate and cookie secret.</li>
<li>Names the <cite>hosts</cite> and <cite>jupyter_hosts</cite> files properly from <cite>hosts.example</cite>
and <cite>jupyter_hosts.example</cite> respectively.</li>
<li>Runs Ansible Playbook.</li>
</ol>
<p>Users can now save time by running the script to configure and deploy
JupyterHub, rather than complete the above tasks manually. Using the script
should be less error-prone compared to the manual setup.</p>
</div>

    </div>
  </article>
  <hr>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function() {
      this.page.url = 'https://mechmotum.github.io/blog/jupyter-winter-2019.html';
      this.page.identifier = 'jupyter-winter-2019';
    };
    (function() {
      var d = document;
      var s = d.createElement('script');
      s.src = '//mechmotum.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript class="text-muted">
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
<div class="row">
  <ul class="col-sm-6 list-inline">
      <li class="list-inline-item"><a href="https://mechmotum.github.io/authors.html">Authors</a></li>
    <li class="list-inline-item"><a href="https://mechmotum.github.io/archives.html">Archives</a></li>
    <li class="list-inline-item"><a href="https://mechmotum.github.io/categories.html">Categories</a></li>
      <li class="list-inline-item"><a href="https://mechmotum.github.io/tags.html">Tags</a></li>
  </ul>
  <p class="col-sm-6 text-sm-right text-muted">
    Generated by <a href="https://github.com/getpelican/pelican" target="_blank">Pelican</a>
    / <a href="https://github.com/nairobilug/pelican-alchemy"
         target="_blank">&#x2728;</a>
    | Edit on <a href="https://github.com/mechmotum/mechmotum.github.io" target="_blank"><i class="fab fa-github"></i></a>
  </p>
</div>
<div class="row">
  <div class="col-sm-4 mx-auto text-center text-muted" >
    <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">
      <img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" />
    </a>
    <br />
    This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
  </div>
</div>    </div>
  </footer>

</body>

</html>